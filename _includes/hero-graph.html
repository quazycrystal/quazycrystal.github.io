<style>
/* ======================================================= */
/* 1. 필수: HTML 및 Minimal Mistakes 부모 요소의 높이 설정 */
/* ======================================================= */
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
}

/* 2. [핵심] 전체 페이지를 Grid 컨테이너로 설정하여 헤더, 푸터, 콘텐츠 영역 분리 */
/* Minimal Mistakes의 기본 레이아웃 컨테이너를 Grid로 제어 */
.layout--default, #main { 
    height: 100%;
    display: grid;
    /* 행(Row) 정의: [고정 크기 헤더] [남은 공간 콘텐츠] [고정 크기 푸터] */
    grid-template-rows: auto auto 1fr auto; 
}

/* 3. 콘텐츠 영역(`.page__content`)이 남은 공간을 100% 차지하도록 설정 */
.page__content {
    height: 100%;
}

/* 4. [추가된 컨테이너] 그래프 컨테이너에 Grid를 적용하여 높이 100% 보장 */
#graph-layout-container {
    height: 100%;
    display: grid; 
    grid-template-rows: 1fr; 
}

/* 5. 그래프 SVG 컨테이너가 Grid 영역을 100% 채우도록 설정 */
#image-graph {
    width: 100%;
    height: 100%; /* [필수] 부모 Grid 행의 높이를 100% 채움 */
}
</style>

<script src="https://d3js.org/d3.v7.min.js"></script>

<div id="graph-layout-container">
    <div id="image-graph" style="width: 98%; height: 98%; background-color: #ffffff; overflow: visible; position: relative; border-radius: 8px;"></div>
</div>

<script>
    // [원래 Liquid 코드는 여기에 그대로 유지되어야 합니다.]
    window.jekyllGraphData = [];

    // [수정 1] limit를 100으로 늘려 Design 글이 짤리지 않게 함
    {% for post in site.posts limit: 100 %}
        
        // [수정 2] 이미지가 있는 경우에만 데이터 추가
        {% if post.header.teaser or post.header.overlay_image %}
          window.jekyllGraphData.push({
            "id": {{ post.url | slugify | jsonify }},
            "title": {{ post.title | jsonify }},
            
            // [수정 3] 카테고리 추출 로직 강화 (배열 첫번째 or 단일 카테고리 or 기타)
            "category": {{ post.categories[0] | default: post.category | default: "etc" | jsonify }},
            
            "imgUrl": "{{ post.header.teaser | default: post.header.overlay_image | relative_url }}",
            "link": "{{ post.url | relative_url }}",
            "size": 50
          });
        {% endif %}
    {% endfor %}

    // [확인용] 브라우저 콘솔(F12)에 카테고리 목록을 찍어봅니다.
    console.log("전체 데이터:", window.jekyllGraphData);
    
    // 카테고리 종류가 뭐뭐 잡혔는지 확인하는 코드
    const categoriesFound = [...new Set(window.jekyllGraphData.map(d => d.category))];
    console.log("발견된 카테고리 목록:", categoriesFound);
</script>
<script src="{{ '/assets/js/home-graph.js' | relative_url }}"></script>